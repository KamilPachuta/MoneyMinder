@using MoneyMinderClient.Components.Dialogs
@using MoneyMinderClient.Core
@using MoneyMinderClient.Services.Interfaces
@inject IAccountService AccountService
@inject ICurrencyAccountService CurrencyService
@inject ISavingsAccountService SavingsService
@inherits BasePage





<AuthorizeView>
    <Authorized>
        @if (!string.IsNullOrWhiteSpace(_name))
        {
            <MudDrawerHeader>
                <MudText Typo="Typo.h6">@_name</MudText>
            </MudDrawerHeader>
        }
        <MudNavMenu>
            <MudNavLink Href="/" Icon="@Icons.Material.Filled.Home">Home</MudNavLink> 
            <MudNavLink Href="/Profile" Icon="@Icons.Material.Filled.AccountCircle">Profile</MudNavLink> 
            <MudNavGroup Title="CurrencyAccounts" Icon="@Icons.Material.Filled.AccountBalance" Expanded="false">
                @foreach (var name in _currencyAccountNames)
                {
                    <MudPaper Outlined="true" Class="px-3 py-1" Elevation="5">
                        <MudNavGroup Title="@name" Icon="@Icons.Material.Filled.AccountBalanceWallet" Expanded="false" Class="">
                            <MudNavLink Href="@PathBuilder.CurrencyAcountPath(name)" Icon="@Icons.Material.Filled.CreditCard">Account</MudNavLink>
                            <MudNavLink Href="@PathBuilder.CurrencyTransactionHistoryPath(name)" Icon="@Icons.Material.Filled.History">Transaction History</MudNavLink>
                            <MudNavLink Href="@PathBuilder.BudgetPath(name)" Icon="@Icons.Material.Filled.BarChart">Budget</MudNavLink>
                        </MudNavGroup>
                    </MudPaper>
                }
                <MudNavLink Icon="@Icons.Material.Filled.AddCard" OnClick="CreateCurrencyAccount">Create</MudNavLink>
            </MudNavGroup>
            <MudNavGroup Title="SavingsAccounts" Icon="@Icons.Material.Filled.Shield" Expanded="false">
                @foreach (var name in _savingsAccountNames)
                {
                    <MudPaper Outlined="true" Class="px-3 py-1" Elevation="5">
                        <MudNavLink Href="@PathBuilder.SavingsAccountPath(name)" Icon="@Icons.Material.Filled.Savings">@name</MudNavLink>
                    </MudPaper>
                }
                <MudNavLink Icon="@Icons.Material.Filled.AddCard" OnClick="CreateSavingsAccount">Create</MudNavLink>
            </MudNavGroup>  
        </MudNavMenu>
    </Authorized>
</AuthorizeView>

@code {
    private string _name = "";
    private List<string> _errorList = new();
    private List<string> _currencyAccountNames = new(); 
    private List<string> _savingsAccountNames = new();




    private async Task CreateCurrencyAccount()
        => await ShowDialogAsync<CreateCurrencyAccountDialog>("Create Currency Account");

    private async Task CreateSavingsAccount()
        => await ShowDialogAsync<CreateSavingsAccountDialog>("Create Savings Account");


    
    private async Task SetParams()
    {
        var responseCurrencyAccounts = await CurrencyService.GetCurrencyAccountNamesAsync();
        if (responseCurrencyAccounts.Succeeded)
        {
            _currencyAccountNames = responseCurrencyAccounts.Response.Names.ToList();
        }
        else
        {
            _errorList = responseCurrencyAccounts.ErrorList;
        }


        var responseSavings = await SavingsService.GetSavingsAccountNames();

        if (responseSavings.Succeeded)
        {
            _savingsAccountNames = responseSavings.Response.Names.ToList();
        }
        else
        {
            _errorList = responseSavings.ErrorList;
        }
        
        _name = await AccountService.GetNameAsync();
        
    }
    
    protected override async Task OnInitializedAsync()
    {
        await SetParams();
    }



}